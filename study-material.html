<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Study Material - EduBot GTU</title>

  <style>
    body { background: #f4f6fb; font-family: Arial; }
    .nav-wrap { background: #003366; padding: 12px 0; color: white; }
    .nav { display: flex; justify-content: space-between; align-items: center; }
    .nav-links { display: flex; gap: 20px; }
    .nav-links a { color: #fff; text-decoration: none; }

    .subject-card {
      background: #fff; padding: 20px; margin: 15px 0;
      border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .btn { padding: 8px 14px; border-radius: 6px; text-decoration:none; color:white; }
    .btn-download { background:#007bff; }
    .btn-view { background:#28a745; }
    .btn-delete { background:#d9534f; }

    .upload-box { background:white; padding:20px; border-radius:10px; margin-top:20px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
  </style>
</head>
<body>

<header class="nav-wrap">
  <div class="nav container">
    <h2 style="color:white;">EduBot GTU</h2>
    <nav class="nav-links">
      <a href="index.html">Home</a>
      <a href="study-material.html" class="active">Study Material</a>
      <a href="ai-tools.html">AI Tools</a>
      <a href="about.html">About</a>
    </nav>
  </div>
</header>

<main class="container">
  <h1>Study Material</h1>
  <p>Admin uploaded + Student self-uploaded materials</p>

  <section id="materials-list"><h2>Loading...</h2></section>

  <!-- STUDENT UPLOAD SECTION -->
  <div class="upload-box">
    <h2>Upload Your Study Material</h2>
    <form id="uploadForm">

      <label>Subject:</label><br>
      <input type="text" id="subject" required><br><br>

      <label>Description:</label><br>
      <textarea id="description" required></textarea><br><br>

      <label>Document Type:</label><br>
      <select id="doctype" required>
        <option value="Notes">Notes</option>
        <option value="Book">Book</option>
        <option value="Syllabus">Syllabus</option>
        <option value="PYQ">PYQ</option>
        <option value="Other">Other</option>
      </select><br><br>

      <label>Select File:</label><br>
      <input type="file" id="fileInput" required><br><br>

      <button type="submit" class="btn-view">Upload</button>
    </form>
  </div>

</main>

<script>
// Load admin materials
let adminData = [];
let studentUploads = JSON.parse(localStorage.getItem("studentUploads") || "[]");

function loadAll() {
  const list = document.getElementById("materials-list");
  list.innerHTML = "";

  const all = [...adminData, ...studentUploads];

  all.forEach((item, index) => {
    const card = document.createElement("div");
    card.className = "subject-card";

    card.innerHTML = `
      <h3>${item.subject} (${item.type})</h3>
      <p>${item.description}</p>
      <a class="btn btn-download" href="${item.link}" download>Download</a>
      <a class="btn btn-view" href="${item.link}" target="_blank">View</a>
      ${item.from === "student" ? `<button class="btn btn-delete" onclick="deleteUpload(${index - adminData.length})">Delete</button>` : ""}
    `;

    list.appendChild(card);
  });
}

// Fetch admin JSON
fetch("data/materials.json")
  .then(r => r.json())
  .then(data => { adminData = data; loadAll(); })
  .catch(() => document.getElementById("materials-list").innerHTML = "<p style='color:red;'>Failed to load admin materials</p>");

// Upload student material

document.getElementById("uploadForm").addEventListener("submit", function(e) {
  e.preventDefault();

  const file = document.getElementById("fileInput").files[0];
  const reader = new FileReader();

  reader.onload = function() {
    const obj = {
      subject: document.getElementById("subject").value,
      description: document.getElementById("description").value,
      type: document.getElementById("doctype").value,
      link: reader.result,
      from: "student"
    };

    studentUploads.push(obj);
    localStorage.setItem("studentUploads", JSON.stringify(studentUploads));
    loadAll();
  };

  reader.readAsDataURL(file);
});

// Delete ONLY self-uploaded items
function deleteUpload(i) {
  studentUploads.splice(i, 1);
  localStorage.setItem("studentUploads", JSON.stringify(studentUploads));
  loadAll();
}

</script>

</body>
</html>
